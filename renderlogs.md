2025-09-28T16:41:09.44724318Z Using cached httptools-0.6.4-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (473 kB)
2025-09-28T16:41:09.448743134Z Using cached pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (801 kB)
2025-09-28T16:41:09.450464273Z Using cached uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)
2025-09-28T16:41:09.455043898Z Using cached watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (451 kB)
2025-09-28T16:41:09.456508122Z Using cached websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-09-28T16:41:09.45774094Z Using cached google_api_python_client-2.183.0-py3-none-any.whl (14.2 MB)
2025-09-28T16:41:09.469689633Z Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl (9.3 kB)
2025-09-28T16:41:09.470778708Z Using cached httplib2-0.31.0-py3-none-any.whl (91 kB)
2025-09-28T16:41:09.471924344Z Using cached pyparsing-3.2.5-py3-none-any.whl (113 kB)
2025-09-28T16:41:09.473099451Z Using cached uritemplate-4.2.0-py3-none-any.whl (11 kB)
2025-09-28T16:41:09.474171735Z Using cached mako-1.3.10-py3-none-any.whl (78 kB)
2025-09-28T16:41:09.475330032Z Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (22 kB)
2025-09-28T16:41:09.476470748Z Using cached pycparser-2.23-py3-none-any.whl (118 kB)
2025-09-28T16:41:09.858211535Z Installing collected packages: pytz, wrapt, websockets, uvloop, urllib3, uritemplate, tzdata, typing-extensions, tqdm, tenacity, structlog, sniffio, six, rapidfuzz, pyyaml, python-multipart, python-dotenv, pyparsing, pymysql, pyjwt, pygments, pycparser, pyasn1, psycopg2-binary, psycopg-binary, psycopg, protobuf, pluggy, packaging, numpy, msgpack, MarkupSafe, iniconfig, idna, hyperframe, httptools, hpack, h11, greenlet, google-crc32c, coverage, click, charset_normalizer, certifi, cachetools, annotated-types, uvicorn, typing-inspection, sqlalchemy, sentry-sdk, rsa, requests, python-dateutil, pytest, pydantic-core, pyasn1-modules, proto-plus, Mako, httplib2, httpcore, h2, grpcio, googleapis-common-protos, google-resumable-media, deprecated, cffi, anyio, watchfiles, starlette, pytest-cov, pytest-asyncio, pydantic, pandas, limits, httpx, grpcio-status, google-auth, cryptography, cachecontrol, alembic, slowapi, google-auth-httplib2, google-api-core, fastapi, google-cloud-core, google-api-python-client, google-cloud-storage, google-cloud-firestore, google-ai-generativelanguage, google-generativeai, firebase-admin
2025-09-28T16:41:54.970087773Z 
2025-09-28T16:41:54.981634225Z Successfully installed Mako-1.3.10 MarkupSafe-3.0.3 alembic-1.16.5 annotated-types-0.7.0 anyio-4.11.0 cachecontrol-0.14.3 cachetools-5.5.2 certifi-2025.8.3 cffi-2.0.0 charset_normalizer-3.4.3 click-8.3.0 coverage-7.10.7 cryptography-46.0.1 deprecated-1.2.18 fastapi-0.117.1 firebase-admin-7.1.0 google-ai-generativelanguage-0.6.15 google-api-core-2.25.1 google-api-python-client-2.183.0 google-auth-2.40.3 google-auth-httplib2-0.2.0 google-cloud-core-2.4.3 google-cloud-firestore-2.21.0 google-cloud-storage-3.4.0 google-crc32c-1.7.1 google-generativeai-0.8.5 google-resumable-media-2.7.2 googleapis-common-protos-1.70.0 greenlet-3.2.4 grpcio-1.75.1 grpcio-status-1.71.2 h11-0.16.0 h2-4.3.0 hpack-4.1.0 httpcore-1.0.9 httplib2-0.31.0 httptools-0.6.4 httpx-0.28.1 hyperframe-6.1.0 idna-3.10 iniconfig-2.1.0 limits-5.5.0 msgpack-1.1.1 numpy-2.3.3 packaging-25.0 pandas-2.3.2 pluggy-1.6.0 proto-plus-1.26.1 protobuf-5.29.5 psycopg-3.2.10 psycopg-binary-3.2.10 psycopg2-binary-2.9.10 pyasn1-0.6.1 pyasn1-modules-0.4.2 pycparser-2.23 pydantic-2.11.9 pydantic-core-2.33.2 pygments-2.19.2 pyjwt-2.10.1 pymysql-1.1.2 pyparsing-3.2.5 pytest-8.4.2 pytest-asyncio-1.2.0 pytest-cov-7.0.0 python-dateutil-2.9.0.post0 python-dotenv-1.1.1 python-multipart-0.0.20 pytz-2025.2 pyyaml-6.0.3 rapidfuzz-3.14.1 requests-2.32.5 rsa-4.9.1 sentry-sdk-2.39.0 six-1.17.0 slowapi-0.1.9 sniffio-1.3.1 sqlalchemy-2.0.43 starlette-0.48.0 structlog-25.4.0 tenacity-9.1.2 tqdm-4.67.1 typing-extensions-4.15.0 typing-inspection-0.4.1 tzdata-2025.2 uritemplate-4.2.0 urllib3-2.5.0 uvicorn-0.37.0 uvloop-0.21.0 watchfiles-1.1.0 websockets-15.0.1 wrapt-1.17.3
2025-09-28T16:41:55.021756955Z 
2025-09-28T16:41:55.021776166Z [notice] A new release of pip is available: 25.1.1 -> 25.2
2025-09-28T16:41:55.021780236Z [notice] To update, run: pip install --upgrade pip
2025-09-28T16:42:38.195116396Z ==> Uploading build...
2025-09-28T16:43:16.122475383Z ==> Uploaded in 14.2s. Compression took 23.7s
2025-09-28T16:43:16.226038613Z ==> Build successful 🎉
2025-09-28T16:44:49.540454323Z ==> Deploying...
2025-09-28T16:45:33.916146242Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T16:45:33.916148642Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T16:45:33.926611449Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_initial, initial tables
2025-09-28T16:45:33.926626939Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_initial, initial tables
2025-09-28T16:45:34.588119415Z 🔄 Checking current database state...
2025-09-28T16:45:34.588158936Z 🔄 Running database migrations...
2025-09-28T16:45:34.588163766Z ⚠️ Migration error: (psycopg2.errors.DuplicateTable) relation "users" already exists
2025-09-28T16:45:34.588168176Z 
2025-09-28T16:45:34.588170936Z [SQL: 
2025-09-28T16:45:34.588174366Z CREATE TABLE users (
2025-09-28T16:45:34.588177016Z 	id VARCHAR NOT NULL, 
2025-09-28T16:45:34.588179626Z 	email VARCHAR, 
2025-09-28T16:45:34.588182836Z 	created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL, 
2025-09-28T16:45:34.588185897Z 	PRIMARY KEY (id)
2025-09-28T16:45:34.588188817Z )
2025-09-28T16:45:34.588191186Z 
2025-09-28T16:45:34.588193626Z ]
2025-09-28T16:45:34.588196167Z (Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-28T16:45:34.588199097Z 🔄 Attempting to continue with existing schema...
2025-09-28T16:45:34.588202357Z ❌ Migration failed: cannot import name 'get_db' from 'src.database.connection' (/opt/render/project/src/backend/src/database/connection.py)
2025-09-28T16:45:34.588204977Z 🔄 Attempting to use simple database initialization...
2025-09-28T16:45:34.588208557Z 🔄 Initializing database...
2025-09-28T16:45:34.588211287Z ✅ Database initialized successfully!
2025-09-28T16:45:34.588213787Z ✅ Database initialized with simple script!
2025-09-28T16:45:56.414385591Z ==> No open ports detected, continuing to scan...
2025-09-28T16:45:56.669481076Z ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
2025-09-28T16:45:59.827970961Z /opt/render/project/src/.venv/lib/python3.13/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
2025-09-28T16:45:59.827990342Z * 'schema_extra' has been renamed to 'json_schema_extra'
2025-09-28T16:45:59.827996532Z   warnings.warn(message, UserWarning)
2025-09-28T16:45:59.930858269Z INFO:     Started server process [57]
2025-09-28T16:45:59.930891149Z INFO:     Waiting for application startup.
2025-09-28T16:46:00.596566317Z INFO:     Application startup complete.
2025-09-28T16:46:00.597165091Z INFO:     Uvicorn running on http://0.0.0.0:10000 (Press CTRL+C to quit)
2025-09-28T16:46:01.153444795Z No .env file found at: /opt/render/project/src/backend/.env
2025-09-28T16:46:01.153471835Z Make sure to create a .env file with your GEMINI_API_KEY
2025-09-28T16:46:01.153475965Z ✅ Gemini API key loaded successfully
2025-09-28T16:46:01.153478886Z 📊 Using model: gemini-flash-latest, temperature: 0.8
2025-09-28T16:46:01.153481606Z 💰 Daily cost limit: $1.0, Monthly: $10.0
2025-09-28T16:46:01.153484706Z ✅ Gemini model 'gemini-flash-latest' configured successfully
2025-09-28T16:46:01.153487636Z ✅ AI Product Descriptions API started successfully
2025-09-28T16:46:01.153490406Z 🤖 Model: gemini-flash-latest (Live mode)
2025-09-28T16:46:01.153494336Z 🌡️  Temperature: 0.8
2025-09-28T16:46:01.153497256Z ✅ API key configured - ready for AI generation
2025-09-28T16:46:01.153500046Z 💳 Credit service initialized - rate limiting enabled
2025-09-28T16:46:01.153503236Z 📋 Subscription plans initialized
2025-09-28T16:46:01.153506496Z INFO:     127.0.0.1:60416 - "HEAD / HTTP/1.1" 404 Not Found
2025-09-28T16:46:10.23342928Z ==> Your service is live 🎉
2025-09-28T16:46:10.332607329Z ==> 
2025-09-28T16:46:10.410317449Z ==> ///////////////////////////////////////////////////////////
2025-09-28T16:46:10.486995069Z ==> 
2025-09-28T16:46:10.564807588Z ==> Available at your primary URL https://ai-product-descriptions.onrender.com
2025-09-28T16:46:10.644222398Z ==> 
2025-09-28T16:46:10.719501307Z ==> ///////////////////////////////////////////////////////////
2025-09-28T16:46:12.368866583Z INFO:     34.82.80.145:0 - "GET / HTTP/1.1" 404 Not Found
2025-09-28T16:46:31.229160492Z WARNING:root:Invalid auth header format
2025-09-28T16:46:31.229436618Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 401 Unauthorized
2025-09-28T16:46:31.543957152Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T16:46:31.544272249Z INFO:     connection open
2025-09-28T16:46:31.618430356Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:31.773423112Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:31.810950991Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:31.816099067Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:32.12440443Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:32.126541909Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:32.321711403Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:32.37728589Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:32.503496314Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:32.50813281Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:32.584766253Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:32.729841354Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:32.731507052Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:32.792727446Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:32.973951305Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:32.991954282Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:32.993825225Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:33.197475271Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:33.36811424Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:36.884714927Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T16:46:37.041473293Z INFO:     41.238.10.39:0 - "GET /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T16:46:37.122732301Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:37.127738924Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:37.237191999Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:37.472747687Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:37.474854574Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:37.590612613Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:37.766200724Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:37.768369513Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:37.875778872Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:40.154324487Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/checkout HTTP/1.1" 200 OK
2025-09-28T16:46:40.677125391Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:40.684250122Z 🎯 STEP 1: CREATE_CHECKOUT ENDPOINT CALLED
2025-09-28T16:46:40.684267602Z Request data: variant_id='1013286' success_url='https://www.productgeniepro.com/billing?success=true' cancel_url='https://www.productgeniepro.com/pricing?cancelled=true'
2025-09-28T16:46:40.684273713Z Variant ID: 1013286
2025-09-28T16:46:40.684278503Z Success URL: https://www.productgeniepro.com/billing?success=true
2025-09-28T16:46:40.684282103Z Cancel URL: https://www.productgeniepro.com/pricing?cancelled=true
2025-09-28T16:46:40.684286303Z 🎯 STEP 2: GETTING CLIENT INFO
2025-09-28T16:46:40.684291183Z Client info: {'ip_address': '41.238.10.39', 'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', 'correlation_id': '3a9a9805-998a-46f3-b1b4-c3a95d687988'}
2025-09-28T16:46:40.684296753Z 🎯 STEP 3: EXTRACTING AUTH DATA
2025-09-28T16:46:40.684300313Z User ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:46:40.684303763Z User email: ziad321hussein@gmail.com
2025-09-28T16:46:40.684307333Z 🎯 STEP 4: VALIDATING USER
2025-09-28T16:46:40.684312153Z ✅ STEP 4 SUCCESS: User validated
2025-09-28T16:46:40.684318114Z 🎯 STEP 5: VALIDATING VARIANT ID
2025-09-28T16:46:40.684323904Z ✅ STEP 5 SUCCESS: Variant ID validated
2025-09-28T16:46:40.684329434Z 🎯 STEP 6: CALLING LEMON_SQUEEZY SERVICE
2025-09-28T16:46:40.684350944Z 🎯 LEMON SQUEEZY PAYLOAD DEBUG 🎯
2025-09-28T16:46:40.684355914Z === VARIABLES ===
2025-09-28T16:46:40.684361344Z Variant ID: 1013286
2025-09-28T16:46:40.684366905Z Store ID: 224253
2025-09-28T16:46:40.684371795Z User ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:46:40.684375265Z User Email: ziad321hussein@gmail.com
2025-09-28T16:46:40.684378805Z Success URL: https://www.productgeniepro.com/billing?success=true
2025-09-28T16:46:40.684382275Z Cancel URL: https://www.productgeniepro.com/pricing?cancelled=true
2025-09-28T16:46:40.684397525Z Test Mode: True
2025-09-28T16:46:40.684399825Z === PAYLOAD BEING SENT ===
2025-09-28T16:46:40.684401905Z {
2025-09-28T16:46:40.684404096Z   "data": {
2025-09-28T16:46:40.684406225Z     "type": "checkouts",
2025-09-28T16:46:40.684408596Z     "attributes": {
2025-09-28T16:46:40.684410646Z       "checkout_options": {
2025-09-28T16:46:40.684412806Z         "embed": false,
2025-09-28T16:46:40.684414816Z         "media": false
2025-09-28T16:46:40.684416896Z       },
2025-09-28T16:46:40.684418956Z       "checkout_data": {
2025-09-28T16:46:40.684421126Z         "email": "ziad321hussein@gmail.com",
2025-09-28T16:46:40.684423246Z         "custom": {
2025-09-28T16:46:40.684426366Z           "user_id": "bpR6MB3823T20EK7BEa3cs2y22u2"
2025-09-28T16:46:40.684428486Z         }
2025-09-28T16:46:40.684430556Z       },
2025-09-28T16:46:40.684432676Z       "product_options": {
2025-09-28T16:46:40.684434856Z         "redirect_url": "https://www.productgeniepro.com/billing?success=true"
2025-09-28T16:46:40.684436966Z       }
2025-09-28T16:46:40.684439066Z     },
2025-09-28T16:46:40.684441116Z     "relationships": {
2025-09-28T16:46:40.684443146Z       "store": {
2025-09-28T16:46:40.684445206Z         "data": {
2025-09-28T16:46:40.684447246Z           "type": "stores",
2025-09-28T16:46:40.684449357Z           "id": "224253"
2025-09-28T16:46:40.684451397Z         }
2025-09-28T16:46:40.684453427Z       },
2025-09-28T16:46:40.684455527Z       "variant": {
2025-09-28T16:46:40.684457607Z         "data": {
2025-09-28T16:46:40.684459677Z           "type": "variants",
2025-09-28T16:46:40.684461727Z           "id": "1013286"
2025-09-28T16:46:40.684463767Z         }
2025-09-28T16:46:40.684465797Z       }
2025-09-28T16:46:40.684467907Z     }
2025-09-28T16:46:40.684470017Z   }
2025-09-28T16:46:40.684472157Z }
2025-09-28T16:46:40.684474257Z === HEADERS ===
2025-09-28T16:46:40.684476357Z {
2025-09-28T16:46:40.684480297Z   "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5NGQ1OWNlZi1kYmI4LTRlYTUtYjE3OC1kMjU0MGZjZDY5MTkiLCJqdGkiOiJkOGY2NTljZjdhMzA3ZGNjM2RjNTk4ZjNiMzU4YTk3YTczYzdhNGJkNDg2ZDlkM2JhYTE4OGQ4Y2MxMGU1Zjc5YWQzODJkZTgyYjgxNjRiNiIsImlhdCI6MTc1ODgyNzU5MC41NzYwMjcsIm5iZiI6MTc1ODgyNzU5MC41NzYwMjksImV4cCI6MjA3NDM2MDM5MC41NjA2NzcsInN1YiI6IjU1NzE5NjQiLCJzY29wZXMiOltdfQ.v6DQ8CrPGAovPSiYrv6Y3GkQ3DWHPcC0aAiZ9mP5BsXCwXoz5Kf1OY-fLAHC4ikcmx2RYZuLbSrF_Xxa4mvw2exFnJMsODiiuzItzhdVGUwR89IzbFAD6hcto-w0ERT3gjP781BJ-lxa7pzC4tCADeRhAtMPM7MZ7h7g-0JsRjXyNDrM0ArKoN84kiGHojmPCBomBuXTQ-mC_VQEWn8PKxTbZEem7FoyP4ydK46xYQu-naukuPTOZHRQ44Mdz_16JQ7Cda2pbfJo2osSPGaLTYUKvH0-aF2jlZToxGCPPr8LbPsHo1-96W2D6CBkCF0kFd6BQd0PKw64X-2ywolNwyna51cLKvkZuOHrh2Z8XVG0GONxeo6b1mFzgs8PzSkaPJ5Er_vhcRQVhAolOVmBHcZ61FUUJ208hR1FUVzMHlrTWtcTAi6HUjthHZB2ZL0xrIkDcWQPxG38i8ArAslXFLytqDTU3tePixq0WDHHBnBq8XSbleFoLH8rdc0j4v5KEPoJyXUS7MrHkiJ602WwLFPuczEdkRPvnSNeRKhsSlPkO8SiQFdHZ6VLCGQoEWDvm7SL2U6lmOJ2T1imOAGiTveGoliycICl_HQo29Fk0VFMFVa_jei7HCgdsLArClUHceqfx5UTOsrWxcd8zr75ALBqDzIWT9tpG5ifdTappes",
2025-09-28T16:46:40.684482947Z   "Accept": "application/vnd.api+json",
2025-09-28T16:46:40.684485047Z   "Content-Type": "application/vnd.api+json",
2025-09-28T16:46:40.684487127Z   "Version": "2021-07-07"
2025-09-28T16:46:40.684489198Z }
2025-09-28T16:46:40.684491318Z === API ENDPOINT ===
2025-09-28T16:46:40.684493427Z POST https://api.lemonsqueezy.com/v1/checkouts
2025-09-28T16:46:40.684495558Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:40.782610526Z === RESPONSE ===
2025-09-28T16:46:40.782627997Z Status: Unknown
2025-09-28T16:46:40.782631227Z Response: {
2025-09-28T16:46:40.782634007Z   "jsonapi": {
2025-09-28T16:46:40.782645907Z     "version": "1.0"
2025-09-28T16:46:40.782649038Z   },
2025-09-28T16:46:40.782651927Z   "links": {
2025-09-28T16:46:40.782656007Z     "self": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9"
2025-09-28T16:46:40.782658818Z   },
2025-09-28T16:46:40.782661758Z   "data": {
2025-09-28T16:46:40.782665878Z     "type": "checkouts",
2025-09-28T16:46:40.782669778Z     "id": "c073b04a-061d-4ab4-a616-9a3a90df27b9",
2025-09-28T16:46:40.782673168Z     "attributes": {
2025-09-28T16:46:40.782676878Z       "store_id": 224253,
2025-09-28T16:46:40.782679948Z       "variant_id": 1013286,
2025-09-28T16:46:40.782682958Z       "custom_price": null,
2025-09-28T16:46:40.782686088Z       "product_options": {
2025-09-28T16:46:40.782689328Z         "name": "",
2025-09-28T16:46:40.782692448Z         "description": "",
2025-09-28T16:46:40.782695559Z         "media": [],
2025-09-28T16:46:40.782699168Z         "redirect_url": "https://www.productgeniepro.com/billing?success=true",
2025-09-28T16:46:40.782702589Z         "receipt_button_text": "",
2025-09-28T16:46:40.782705929Z         "receipt_link_url": "",
2025-09-28T16:46:40.782709109Z         "receipt_thank_you_note": "",
2025-09-28T16:46:40.782712019Z         "enabled_variants": [],
2025-09-28T16:46:40.782715089Z         "confirmation_title": "",
2025-09-28T16:46:40.782718579Z         "confirmation_message": "",
2025-09-28T16:46:40.782721669Z         "confirmation_button_text": ""
2025-09-28T16:46:40.782725189Z       },
2025-09-28T16:46:40.782728699Z       "checkout_options": {
2025-09-28T16:46:40.782732069Z         "embed": false,
2025-09-28T16:46:40.782735289Z         "media": false,
2025-09-28T16:46:40.78273838Z         "logo": true,
2025-09-28T16:46:40.78274178Z         "desc": true,
2025-09-28T16:46:40.782745069Z         "discount": true,
2025-09-28T16:46:40.7827487Z         "skip_trial": false,
2025-09-28T16:46:40.78275203Z         "quantity": 1,
2025-09-28T16:46:40.78275541Z         "subscription_preview": true,
2025-09-28T16:46:40.78275903Z         "locale": "en"
2025-09-28T16:46:40.78276265Z       },
2025-09-28T16:46:40.78276512Z       "checkout_data": {
2025-09-28T16:46:40.78276723Z         "email": "ziad321hussein@gmail.com",
2025-09-28T16:46:40.78276938Z         "name": "",
2025-09-28T16:46:40.78277144Z         "billing_address": [],
2025-09-28T16:46:40.78277353Z         "tax_number": "",
2025-09-28T16:46:40.78277564Z         "discount_code": "",
2025-09-28T16:46:40.78277768Z         "custom": {
2025-09-28T16:46:40.78277978Z           "user_id": "bpR6MB3823T20EK7BEa3cs2y22u2"
2025-09-28T16:46:40.782781881Z         },
2025-09-28T16:46:40.782784081Z         "variant_quantities": []
2025-09-28T16:46:40.78278637Z       },
2025-09-28T16:46:40.78278849Z       "preview": false,
2025-09-28T16:46:40.782790591Z       "expires_at": null,
2025-09-28T16:46:40.782792651Z       "created_at": "2025-09-28T16:46:40.000000Z",
2025-09-28T16:46:40.782794811Z       "updated_at": "2025-09-28T16:46:40.000000Z",
2025-09-28T16:46:40.782796851Z       "test_mode": true,
2025-09-28T16:46:40.782800311Z       "url": "https://product-genie.lemonsqueezy.com/checkout/custom/c073b04a-061d-4ab4-a616-9a3a90df27b9?signature=dab4f87bca55f115adf20d978f0d2ffbc2d04d244dc79c597b94a922202b4867"
2025-09-28T16:46:40.782803921Z     },
2025-09-28T16:46:40.782807681Z     "relationships": {
2025-09-28T16:46:40.782811191Z       "store": {
2025-09-28T16:46:40.782814581Z         "links": {
2025-09-28T16:46:40.782818621Z           "related": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9/store",
2025-09-28T16:46:40.782830331Z           "self": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9/relationships/store"
2025-09-28T16:46:40.782834051Z         }
2025-09-28T16:46:40.782837752Z       },
2025-09-28T16:46:40.782841232Z       "variant": {
2025-09-28T16:46:40.782843962Z         "links": {
2025-09-28T16:46:40.782847542Z           "related": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9/variant",
2025-09-28T16:46:40.782851142Z           "self": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9/relationships/variant"
2025-09-28T16:46:40.782854432Z         }
2025-09-28T16:46:40.782857802Z       }
2025-09-28T16:46:40.782860992Z     },
2025-09-28T16:46:40.782864392Z     "links": {
2025-09-28T16:46:40.782867712Z       "self": "https://api.lemonsqueezy.com/v1/checkouts/c073b04a-061d-4ab4-a616-9a3a90df27b9"
2025-09-28T16:46:40.782871183Z     }
2025-09-28T16:46:40.782874972Z   }
2025-09-28T16:46:40.782878593Z }
2025-09-28T16:46:40.782880863Z ✅ STEP 6 SUCCESS: Lemon Squeezy service call successful
2025-09-28T16:46:40.782884943Z Result: {'success': True, 'checkout_url': 'https://product-genie.lemonsqueezy.com/checkout/custom/c073b04a-061d-4ab4-a616-9a3a90df27b9?signature=dab4f87bca55f115adf20d978f0d2ffbc2d04d244dc79c597b94a922202b4867', 'checkout_id': 'c073b04a-061d-4ab4-a616-9a3a90df27b9'}
2025-09-28T16:46:40.782887213Z INFO:     41.238.10.39:0 - "POST /api/payment/checkout HTTP/1.1" 200 OK
2025-09-28T16:46:40.783264611Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:41.101851527Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T16:46:41.104165569Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:46:41.147456028Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:46:43.05673818Z INFO:     connection closed
2025-09-28T16:47:17.749175822Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T16:47:17.748608+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T16:47:17.779992938Z 🎯 WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T16:47:17.780017319Z 🎯 WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '3394', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9864b8c79ecf18aa-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': 'b1e9cc73-6063-4d50', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_created', 'x-forwarded-for': '18.116.135.47, 104.23.197.55, 10.226.169.130', 'x-forwarded-proto': 'https', 'x-request-start': '1759078037746732', 'x-signature': 'fa879c1d9f069a285b803089657e6e5a16cfd39c4810ccf280c6c54276c31ee9'}
2025-09-28T16:47:17.780023729Z 🎯 BillingService: Processing webhook event_id=fa879c1d9f069a285b803089657e6e5a16cfd39c4810ccf280c6c54276c31ee9
2025-09-28T16:47:17.780036659Z 🎯 BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_created', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': '3cc7a13c-acb3-4a3d-aedb-1ea6f93acad9'}, 'data': {'type': 'subscriptions', 'id': '1521269', 'attributes': {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492747, 'order_item_id': 6436583, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4514597, 'subscription_id': 1521269, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T16:47:17.000000Z', 'updated_at': '2025-09-28T16:47:17.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521269/payment-details?expires=1759099637&signature=e94f4e741ec37b0ba9ade8a52e5e934e415c344ccbacfe7a1fb394a2b256666f', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759099637&test_mode=1&user=5534177&signature=288e626fb31fad50f57368c57526f1e18656e03c94c566ca55024b6e916e127b', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521269/update?expires=1759099637&user=5534177&signature=78d1f0a26a63c3e02110fcb9683c28858383cab27da3265d1926ea42871fae40'}, 'renews_at': '2025-10-28T16:47:08.000000Z', 'ends_at': None, 'created_at': '2025-09-28T16:47:09.000000Z', 'updated_at': '2025-09-28T16:47:15.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/store', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/store'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/customer'}}, 'order': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/order', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/order'}}, 'order-item': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/order-item', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/order-item'}}, 'product': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/product', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/product'}}, 'variant': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/variant', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/variant'}}, 'subscription-items': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/subscription-items', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/subscription-items'}}, 'subscription-invoices': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/subscription-invoices', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/subscription-invoices'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269'}}}
2025-09-28T16:47:17.78006362Z 🎯 BillingService: Event fa879c1d9f069a285b803089657e6e5a16cfd39c4810ccf280c6c54276c31ee9 is new, processing...
2025-09-28T16:47:17.78006804Z 🎯 BillingService: Event type: subscription_created
2025-09-28T16:47:17.780088401Z 🎯 BillingService: Attributes: {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492747, 'order_item_id': 6436583, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4514597, 'subscription_id': 1521269, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T16:47:17.000000Z', 'updated_at': '2025-09-28T16:47:17.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521269/payment-details?expires=1759099637&signature=e94f4e741ec37b0ba9ade8a52e5e934e415c344ccbacfe7a1fb394a2b256666f', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759099637&test_mode=1&user=5534177&signature=288e626fb31fad50f57368c57526f1e18656e03c94c566ca55024b6e916e127b', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521269/update?expires=1759099637&user=5534177&signature=78d1f0a26a63c3e02110fcb9683c28858383cab27da3265d1926ea42871fae40'}, 'renews_at': '2025-10-28T16:47:08.000000Z', 'ends_at': None, 'created_at': '2025-09-28T16:47:09.000000Z', 'updated_at': '2025-09-28T16:47:15.000000Z', 'test_mode': True}
2025-09-28T16:47:17.780099881Z ✅ Using user_id: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:47:17.780102901Z 🎯 BillingService: Checking event type 'subscription_created' against subscription events
2025-09-28T16:47:17.780106501Z 🎯 BillingService: is_subscription_event=True, has_subscription_data=True
2025-09-28T16:47:17.780109741Z 🔧 Mapping variant_id: 1013286 (type: <class 'int'>)
2025-09-28T16:47:17.780112041Z 🔧 Available mappings: {'1013286': 'pro', '1013276': 'enterprise', '1013282': 'pro-yearly'}
2025-09-28T16:47:17.780114471Z 🔧 Mapped to plan: pro
2025-09-28T16:47:17.780116121Z 🔧 Mapped variant_id 1013286 to plan: pro
2025-09-28T16:47:17.780118041Z ✅ Ensured user bpR6MB3823T20EK7BEa3cs2y22u2 exists in users table
2025-09-28T16:47:17.780119711Z ✅ Created new subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro
2025-09-28T16:47:17.780121321Z ✅ Updated Subscription table for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro
2025-09-28T16:47:17.780123071Z ✅ Created new UserSubscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan_id=pro
2025-09-28T16:47:17.780125321Z ✅ Updated subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro, status=SubscriptionStatus.active
2025-09-28T16:47:17.780127101Z ✅ Committed subscription update to database
2025-09-28T16:47:17.780128801Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK
2025-09-28T16:47:19.937333803Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T16:47:19.937354073Z INFO:     connection open
2025-09-28T16:47:20.09817089Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:20.140808854Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:20.294688954Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:20.349091924Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:20.482772527Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:20.547262785Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:20.724175345Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:20.834968321Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:20.936079647Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:21.147200402Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:24.19851538Z INFO:     41.238.10.39:0 - "GET /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T16:47:24.430147168Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:24.494665517Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:24.747438122Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:24.932575239Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:26.549093373Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:26.606618273Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:26.915019767Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:27.021830302Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:31.640367717Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:31.788428905Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:32.043010952Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T16:47:32.15922447Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T16:47:46.339715298Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T16:47:46.339455+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T16:47:46.366311559Z 🎯 WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T16:47:46.396901461Z 🎯 WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '1997', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9864b97a7bf3cf77-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': '439c441c-d701-4353', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_payment_success', 'x-forwarded-for': '18.116.135.47, 104.23.197.55, 10.226.169.130', 'x-forwarded-proto': 'https', 'x-request-start': '1759078066338323', 'x-signature': '9b7cade5ac4adac68d99c272d902f5e7e8d0b58600a20f5d3a64bcaf7dfd8fb4'}
2025-09-28T16:47:46.396911261Z 🎯 BillingService: Processing webhook event_id=9b7cade5ac4adac68d99c272d902f5e7e8d0b58600a20f5d3a64bcaf7dfd8fb4
2025-09-28T16:47:46.396917571Z 🎯 BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_payment_success', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': 'e6dbcc8f-e70a-4563-8339-f983a9a49e91'}, 'data': {'type': 'subscription-invoices', 'id': '4587724', 'attributes': {'store_id': 224253, 'subscription_id': 1521269, 'customer_id': 6829303, 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'billing_reason': 'initial', 'card_brand': 'visa', 'card_last_four': '4242', 'currency': 'USD', 'currency_rate': '1.00000000', 'status': 'paid', 'status_formatted': 'Paid', 'refunded': False, 'refunded_at': None, 'subtotal': 499, 'discount_total': 0, 'tax': 0, 'tax_inclusive': False, 'total': 499, 'refunded_amount': 0, 'subtotal_usd': 499, 'discount_total_usd': 0, 'tax_usd': 0, 'total_usd': 499, 'refunded_amount_usd': 0, 'subtotal_formatted': '$4.99', 'discount_total_formatted': '$0.00', 'tax_formatted': '$0.00', 'total_formatted': '$4.99', 'refunded_amount_formatted': '$0.00', 'urls': {'invoice_url': 'https://app.lemonsqueezy.com/my-orders/5d83a700-5c23-4c6c-b129-6a39e3ac90a0/subscription-invoice/4587724?expires=1759099666&signature=8495ae9886169e39219b6a48ddd9c9abd88cf88606ad3aee0ba062ae9ab8f10e'}, 'created_at': '2025-09-28T16:47:13.000000Z', 'updated_at': '2025-09-28T16:47:46.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/store', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/relationships/store'}}, 'subscription': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/subscription', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/relationships/subscription'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724/relationships/customer'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4587724'}}}
2025-09-28T16:47:46.396933771Z 🎯 BillingService: Event 9b7cade5ac4adac68d99c272d902f5e7e8d0b58600a20f5d3a64bcaf7dfd8fb4 is new, processing...
2025-09-28T16:47:46.396952442Z 🎯 BillingService: Event type: subscription_payment_success
2025-09-28T16:47:46.396972382Z 🎯 BillingService: Attributes: {'store_id': 224253, 'subscription_id': 1521269, 'customer_id': 6829303, 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'billing_reason': 'initial', 'card_brand': 'visa', 'card_last_four': '4242', 'currency': 'USD', 'currency_rate': '1.00000000', 'status': 'paid', 'status_formatted': 'Paid', 'refunded': False, 'refunded_at': None, 'subtotal': 499, 'discount_total': 0, 'tax': 0, 'tax_inclusive': False, 'total': 499, 'refunded_amount': 0, 'subtotal_usd': 499, 'discount_total_usd': 0, 'tax_usd': 0, 'total_usd': 499, 'refunded_amount_usd': 0, 'subtotal_formatted': '$4.99', 'discount_total_formatted': '$0.00', 'tax_formatted': '$0.00', 'total_formatted': '$4.99', 'refunded_amount_formatted': '$0.00', 'urls': {'invoice_url': 'https://app.lemonsqueezy.com/my-orders/5d83a700-5c23-4c6c-b129-6a39e3ac90a0/subscription-invoice/4587724?expires=1759099666&signature=8495ae9886169e39219b6a48ddd9c9abd88cf88606ad3aee0ba062ae9ab8f10e'}, 'created_at': '2025-09-28T16:47:13.000000Z', 'updated_at': '2025-09-28T16:47:46.000000Z', 'test_mode': True}
2025-09-28T16:47:46.396976783Z ✅ Using user_id: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:47:46.396981332Z 🎯 BillingService: Checking event type 'subscription_payment_success' against subscription events
2025-09-28T16:47:46.396985033Z 🎯 BillingService: is_subscription_event=True, has_subscription_data=False
2025-09-28T16:47:46.396987363Z 🎯 Processing payment success event for user bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:47:46.396989783Z 🔧 Payment success: Using existing plan pro
2025-09-28T16:47:46.396992513Z ✅ Ensured user bpR6MB3823T20EK7BEa3cs2y22u2 exists in users table
2025-09-28T16:47:46.396997563Z 🔄 Updating existing subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: pro -> pro
2025-09-28T16:47:46.397001053Z ✅ Updated subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro, status=SubscriptionStatus.active
2025-09-28T16:47:46.397003723Z ✅ Updated Subscription table for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro
2025-09-28T16:47:46.397006413Z ✅ Updated UserSubscription table for user bpR6MB3823T20EK7BEa3cs2y22u2: plan_id=pro, status=active
2025-09-28T16:47:46.397008953Z ✅ Updated subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro, status=active
2025-09-28T16:47:46.397011203Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK
2025-09-28T16:47:47.441000458Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T16:47:47.440731+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T16:47:47.465974443Z 🎯 WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T16:47:47.465998514Z 🎯 WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '3394', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9864b9815e53cf7d-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': 'e663b236-ea58-47a6', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_updated', 'x-forwarded-for': '18.116.135.47, 104.23.197.55, 10.226.169.130', 'x-forwarded-proto': 'https', 'x-request-start': '1759078067439846', 'x-signature': '602ef0119a9a3705723f24630b5501fbc7c8d13a7eb865c109a098c37141d5b9'}
2025-09-28T16:47:47.466014414Z 🎯 BillingService: Processing webhook event_id=602ef0119a9a3705723f24630b5501fbc7c8d13a7eb865c109a098c37141d5b9
2025-09-28T16:47:47.466023564Z 🎯 BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_updated', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': '1c174173-8dc2-4b00-a1cd-dc02340b8559'}, 'data': {'type': 'subscriptions', 'id': '1521269', 'attributes': {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492747, 'order_item_id': 6436583, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4514597, 'subscription_id': 1521269, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T16:47:17.000000Z', 'updated_at': '2025-09-28T16:47:47.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521269/payment-details?expires=1759099667&signature=7469f4758b0c4f72840e53256188970471f193d578095d1d4660950094edd803', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759099667&test_mode=1&user=5534177&signature=e577c7dbaf2cb94780c58d7a82cf5d4b4d2be0e10246657ae91458c41d7c6b4c', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521269/update?expires=1759099667&user=5534177&signature=197d4fb626d4237b21456c049f345a8a5533278b6f4e02d70a668598330fdfe9'}, 'renews_at': '2025-10-28T16:47:08.000000Z', 'ends_at': None, 'created_at': '2025-09-28T16:47:09.000000Z', 'updated_at': '2025-09-28T16:47:15.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/store', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/store'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/customer'}}, 'order': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/order', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/order'}}, 'order-item': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/order-item', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/order-item'}}, 'product': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/product', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/product'}}, 'variant': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/variant', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/variant'}}, 'subscription-items': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/subscription-items', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/subscription-items'}}, 'subscription-invoices': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/subscription-invoices', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269/relationships/subscription-invoices'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521269'}}}
2025-09-28T16:47:47.466043515Z 🎯 BillingService: Event 602ef0119a9a3705723f24630b5501fbc7c8d13a7eb865c109a098c37141d5b9 is new, processing...
2025-09-28T16:47:47.466047904Z 🎯 BillingService: Event type: subscription_updated
2025-09-28T16:47:47.466058605Z 🎯 BillingService: Attributes: {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492747, 'order_item_id': 6436583, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4514597, 'subscription_id': 1521269, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T16:47:17.000000Z', 'updated_at': '2025-09-28T16:47:47.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521269/payment-details?expires=1759099667&signature=7469f4758b0c4f72840e53256188970471f193d578095d1d4660950094edd803', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759099667&test_mode=1&user=5534177&signature=e577c7dbaf2cb94780c58d7a82cf5d4b4d2be0e10246657ae91458c41d7c6b4c', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521269/update?expires=1759099667&user=5534177&signature=197d4fb626d4237b21456c049f345a8a5533278b6f4e02d70a668598330fdfe9'}, 'renews_at': '2025-10-28T16:47:08.000000Z', 'ends_at': None, 'created_at': '2025-09-28T16:47:09.000000Z', 'updated_at': '2025-09-28T16:47:15.000000Z', 'test_mode': True}
2025-09-28T16:47:47.466061965Z ✅ Using user_id: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T16:47:47.466064765Z 🎯 BillingService: Checking event type 'subscription_updated' against subscription events
2025-09-28T16:47:47.466067695Z 🎯 BillingService: is_subscription_event=True, has_subscription_data=True
2025-09-28T16:47:47.466070375Z 🔧 Mapping variant_id: 1013286 (type: <class 'int'>)
2025-09-28T16:47:47.466073035Z 🔧 Available mappings: {'1013286': 'pro', '1013276': 'enterprise', '1013282': 'pro-yearly'}
2025-09-28T16:47:47.466076235Z 🔧 Mapped to plan: pro
2025-09-28T16:47:47.466079015Z 🔧 Mapped variant_id 1013286 to plan: pro
2025-09-28T16:47:47.466081575Z ✅ Ensured user bpR6MB3823T20EK7BEa3cs2y22u2 exists in users table
2025-09-28T16:47:47.466083945Z 🔄 Updating existing subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: pro -> pro
2025-09-28T16:47:47.466087065Z ✅ Updated subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro, status=SubscriptionStatus.active
2025-09-28T16:47:47.466090065Z ✅ Updated Subscription table for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro
2025-09-28T16:47:47.466092836Z ✅ Updated UserSubscription table for user bpR6MB3823T20EK7BEa3cs2y22u2: plan_id=pro, status=active
2025-09-28T16:47:47.466095576Z ✅ Updated subscription for user bpR6MB3823T20EK7BEa3cs2y22u2: plan=pro, status=SubscriptionStatus.active
2025-09-28T16:47:47.466098316Z ✅ Committed subscription update to database
2025-09-28T16:47:47.466101086Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK