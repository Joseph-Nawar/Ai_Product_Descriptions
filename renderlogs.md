2025-09-28T14:09:09.957780585Z Using cached pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (801 kB)
2025-09-28T14:09:09.959779103Z Using cached uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)
2025-09-28T14:09:09.965075943Z Using cached watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (451 kB)
2025-09-28T14:09:09.966793815Z Using cached websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-09-28T14:09:09.968252391Z Using cached google_api_python_client-2.183.0-py3-none-any.whl (14.2 MB)
2025-09-28T14:09:09.981486414Z Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl (9.3 kB)
2025-09-28T14:09:09.982597321Z Using cached httplib2-0.31.0-py3-none-any.whl (91 kB)
2025-09-28T14:09:09.98377369Z Using cached pyparsing-3.2.5-py3-none-any.whl (113 kB)
2025-09-28T14:09:09.984946729Z Using cached uritemplate-4.2.0-py3-none-any.whl (11 kB)
2025-09-28T14:09:09.986078637Z Using cached mako-1.3.10-py3-none-any.whl (78 kB)
2025-09-28T14:09:09.987465951Z Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (22 kB)
2025-09-28T14:09:09.988584038Z Using cached pycparser-2.23-py3-none-any.whl (118 kB)
2025-09-28T14:09:10.413713646Z Installing collected packages: pytz, wrapt, websockets, uvloop, urllib3, uritemplate, tzdata, typing-extensions, tqdm, tenacity, structlog, sniffio, six, rapidfuzz, pyyaml, python-multipart, python-dotenv, pyparsing, pymysql, pyjwt, pygments, pycparser, pyasn1, psycopg2-binary, psycopg-binary, psycopg, protobuf, pluggy, packaging, numpy, msgpack, MarkupSafe, iniconfig, idna, hyperframe, httptools, hpack, h11, greenlet, google-crc32c, coverage, click, charset_normalizer, certifi, cachetools, annotated-types, uvicorn, typing-inspection, sqlalchemy, sentry-sdk, rsa, requests, python-dateutil, pytest, pydantic-core, pyasn1-modules, proto-plus, Mako, httplib2, httpcore, h2, grpcio, googleapis-common-protos, google-resumable-media, deprecated, cffi, anyio, watchfiles, starlette, pytest-cov, pytest-asyncio, pydantic, pandas, limits, httpx, grpcio-status, google-auth, cryptography, cachecontrol, alembic, slowapi, google-auth-httplib2, google-api-core, fastapi, google-cloud-core, google-api-python-client, google-cloud-storage, google-cloud-firestore, google-ai-generativelanguage, google-generativeai, firebase-admin
2025-09-28T14:09:39.09299074Z 
2025-09-28T14:09:39.106117151Z Successfully installed Mako-1.3.10 MarkupSafe-3.0.3 alembic-1.16.5 annotated-types-0.7.0 anyio-4.11.0 cachecontrol-0.14.3 cachetools-5.5.2 certifi-2025.8.3 cffi-2.0.0 charset_normalizer-3.4.3 click-8.3.0 coverage-7.10.7 cryptography-46.0.1 deprecated-1.2.18 fastapi-0.117.1 firebase-admin-7.1.0 google-ai-generativelanguage-0.6.15 google-api-core-2.25.1 google-api-python-client-2.183.0 google-auth-2.40.3 google-auth-httplib2-0.2.0 google-cloud-core-2.4.3 google-cloud-firestore-2.21.0 google-cloud-storage-3.4.0 google-crc32c-1.7.1 google-generativeai-0.8.5 google-resumable-media-2.7.2 googleapis-common-protos-1.70.0 greenlet-3.2.4 grpcio-1.75.1 grpcio-status-1.71.2 h11-0.16.0 h2-4.3.0 hpack-4.1.0 httpcore-1.0.9 httplib2-0.31.0 httptools-0.6.4 httpx-0.28.1 hyperframe-6.1.0 idna-3.10 iniconfig-2.1.0 limits-5.5.0 msgpack-1.1.1 numpy-2.3.3 packaging-25.0 pandas-2.3.2 pluggy-1.6.0 proto-plus-1.26.1 protobuf-5.29.5 psycopg-3.2.10 psycopg-binary-3.2.10 psycopg2-binary-2.9.10 pyasn1-0.6.1 pyasn1-modules-0.4.2 pycparser-2.23 pydantic-2.11.9 pydantic-core-2.33.2 pygments-2.19.2 pyjwt-2.10.1 pymysql-1.1.2 pyparsing-3.2.5 pytest-8.4.2 pytest-asyncio-1.2.0 pytest-cov-7.0.0 python-dateutil-2.9.0.post0 python-dotenv-1.1.1 python-multipart-0.0.20 pytz-2025.2 pyyaml-6.0.3 rapidfuzz-3.14.1 requests-2.32.5 rsa-4.9.1 sentry-sdk-2.39.0 six-1.17.0 slowapi-0.1.9 sniffio-1.3.1 sqlalchemy-2.0.43 starlette-0.48.0 structlog-25.4.0 tenacity-9.1.2 tqdm-4.67.1 typing-extensions-4.15.0 typing-inspection-0.4.1 tzdata-2025.2 uritemplate-4.2.0 urllib3-2.5.0 uvicorn-0.37.0 uvloop-0.21.0 watchfiles-1.1.0 websockets-15.0.1 wrapt-1.17.3
2025-09-28T14:09:39.115320976Z 
2025-09-28T14:09:39.115340527Z [notice] A new release of pip is available: 25.1.1 -> 25.2
2025-09-28T14:09:39.115346037Z [notice] To update, run: pip install --upgrade pip
2025-09-28T14:09:42.502607514Z ==> Uploading build...
2025-09-28T14:10:04.322200773Z ==> Uploaded in 14.1s. Compression took 7.7s
2025-09-28T14:10:04.427346065Z ==> Build successful ðŸŽ‰
2025-09-28T14:10:09.254102096Z ==> Deploying...
2025-09-28T14:10:40.451496626Z ==> Running '  cd backend && python fix_database.py && python run_migrations.py && uvicorn src.main:app --host 0.0.0.0 --port $PORT'
2025-09-28T14:10:45.961444819Z ðŸ”§ Database Fix Script
2025-09-28T14:10:45.96146678Z ==================================================
2025-09-28T14:10:45.96147015Z âœ… Found database URL: postgresql://ai_descriptions_db_user:ijlatK7LezNTw...
2025-09-28T14:10:45.96147366Z âœ… Database connection established
2025-09-28T14:10:45.96147592Z ðŸ”„ Creating subscriptions table...
2025-09-28T14:10:45.96147804Z ðŸ”„ Creating indexes...
2025-09-28T14:10:45.9614801Z ðŸ”„ Creating webhook_events table...
2025-09-28T14:10:45.96148241Z ðŸ”„ Creating transactions table...
2025-09-28T14:10:45.96148519Z ðŸ”„ Creating usage table...
2025-09-28T14:10:45.9614876Z ðŸ”„ Creating user_credits table...
2025-09-28T14:10:45.96148979Z âœ… All tables created successfully!
2025-09-28T14:10:45.96149212Z ðŸŽ‰ Database fix completed successfully!
2025-09-28T14:10:51.929456504Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-09-28T14:10:51.929490625Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-09-28T14:10:51.929547566Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T14:10:51.929554826Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T14:10:52.115895156Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-09-28T14:10:52.115919127Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-09-28T14:10:52.115929947Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T14:10:52.115934257Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-09-28T14:10:52.1308752Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_initial, initial tables
2025-09-28T14:10:52.13088972Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_initial, initial tables
2025-09-28T14:10:52.780729052Z ðŸ”„ Checking current database state...
2025-09-28T14:10:52.780751453Z ðŸ”„ Running database migrations...
2025-09-28T14:10:52.780755563Z âš ï¸ Migration error: (psycopg2.errors.DuplicateTable) relation "users" already exists
2025-09-28T14:10:52.780761843Z 
2025-09-28T14:10:52.780764803Z [SQL: 
2025-09-28T14:10:52.780768163Z CREATE TABLE users (
2025-09-28T14:10:52.780770993Z 	id VARCHAR NOT NULL, 
2025-09-28T14:10:52.780774473Z 	email VARCHAR, 
2025-09-28T14:10:52.780777893Z 	created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL, 
2025-09-28T14:10:52.780780804Z 	PRIMARY KEY (id)
2025-09-28T14:10:52.780783584Z )
2025-09-28T14:10:52.780786304Z 
2025-09-28T14:10:52.780789024Z ]
2025-09-28T14:10:52.780791814Z (Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-28T14:10:52.780794634Z ðŸ”„ Attempting to continue with existing schema...
2025-09-28T14:10:52.780798044Z âŒ Migration failed: cannot import name 'get_db' from 'src.database.connection' (/opt/render/project/src/backend/src/database/connection.py)
2025-09-28T14:10:52.780800824Z ðŸ”„ Attempting to use simple database initialization...
2025-09-28T14:10:52.780804294Z ðŸ”„ Initializing database...
2025-09-28T14:10:52.780807114Z âœ… Database initialized successfully!
2025-09-28T14:10:52.780810064Z âœ… Database initialized with simple script!
2025-09-28T14:11:12.364642611Z ==> No open ports detected, continuing to scan...
2025-09-28T14:11:12.600490376Z ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
2025-09-28T14:11:14.654307302Z /opt/render/project/src/.venv/lib/python3.13/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
2025-09-28T14:11:14.654330453Z * 'schema_extra' has been renamed to 'json_schema_extra'
2025-09-28T14:11:14.654337393Z   warnings.warn(message, UserWarning)
2025-09-28T14:11:14.84411991Z INFO:     Started server process [56]
2025-09-28T14:11:14.84415841Z INFO:     Waiting for application startup.
2025-09-28T14:11:15.537547503Z INFO:     Application startup complete.
2025-09-28T14:11:15.538143556Z INFO:     Uvicorn running on http://0.0.0.0:10000 (Press CTRL+C to quit)
2025-09-28T14:11:16.123428771Z No .env file found at: /opt/render/project/src/backend/.env
2025-09-28T14:11:16.123459661Z Make sure to create a .env file with your GEMINI_API_KEY
2025-09-28T14:11:16.123464642Z âœ… Gemini API key loaded successfully
2025-09-28T14:11:16.123467632Z ðŸ“Š Using model: gemini-flash-latest, temperature: 0.8
2025-09-28T14:11:16.123470782Z ðŸ’° Daily cost limit: $1.0, Monthly: $10.0
2025-09-28T14:11:16.123473932Z âœ… Gemini model 'gemini-flash-latest' configured successfully
2025-09-28T14:11:16.123481472Z âœ… AI Product Descriptions API started successfully
2025-09-28T14:11:16.123485202Z ðŸ¤– Model: gemini-flash-latest (Live mode)
2025-09-28T14:11:16.123489052Z ðŸŒ¡ï¸  Temperature: 0.8
2025-09-28T14:11:16.123492472Z âœ… API key configured - ready for AI generation
2025-09-28T14:11:16.123495952Z ðŸ’³ Credit service initialized - rate limiting enabled
2025-09-28T14:11:16.123499192Z ðŸ“‹ Subscription plans initialized
2025-09-28T14:11:16.123501822Z INFO:     127.0.0.1:42154 - "HEAD / HTTP/1.1" 404 Not Found
2025-09-28T14:11:19.950147868Z ==> Your service is live ðŸŽ‰
2025-09-28T14:11:20.089258388Z ==> 
2025-09-28T14:11:20.165005338Z ==> ///////////////////////////////////////////////////////////
2025-09-28T14:11:20.241519717Z ==> 
2025-09-28T14:11:20.322738537Z ==> Available at your primary URL https://ai-product-descriptions.onrender.com
2025-09-28T14:11:20.414953537Z ==> 
2025-09-28T14:11:20.491020176Z ==> ///////////////////////////////////////////////////////////
2025-09-28T14:11:21.928716818Z INFO:     34.168.108.203:0 - "GET / HTTP/1.1" 404 Not Found
2025-09-28T14:11:35.952157227Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T14:11:35.952546106Z INFO:     connection open
2025-09-28T14:11:36.471311149Z INFO:     connection closed
2025-09-28T14:11:43.190538219Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T14:11:43.190700583Z INFO:     connection open
2025-09-28T14:12:50.390903357Z INFO:     connection closed
2025-09-28T14:13:05.946806595Z WARNING:root:Invalid auth header format
2025-09-28T14:13:05.947072311Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 401 Unauthorized
2025-09-28T14:15:29.542267104Z WARNING:root:Invalid auth header format
2025-09-28T14:15:29.542671073Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 401 Unauthorized
2025-09-28T14:15:29.754855978Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T14:15:29.754994081Z INFO:     connection open
2025-09-28T14:15:29.910445783Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:30.000721963Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:30.056316191Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:30.057935757Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:30.548727166Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:30.722811972Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:15:30.723436056Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:30.725148504Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:30.903379912Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:15:30.919350518Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:30.920706258Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:31.101203777Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:15:31.104094872Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:31.172473424Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:31.288715993Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:15:31.291491425Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:15:31.379091705Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:31.583483616Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:15:31.793138465Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:03.051934188Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T14:16:03.184291065Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:03.1872178Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:03.213639349Z INFO:     41.238.10.39:0 - "GET /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T14:16:03.310554876Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:03.415604806Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:03.41713556Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:03.531891855Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:03.796139499Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:03.797701234Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:03.97537269Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:04.537311242Z INFO:     41.238.10.39:0 - "OPTIONS /api/payment/checkout HTTP/1.1" 200 OK
2025-09-28T14:16:05.076793875Z ðŸŽ¯ STEP 1: CREATE_CHECKOUT ENDPOINT CALLED
2025-09-28T14:16:05.076821925Z Request data: variant_id='1013286' success_url='https://www.productgeniepro.com/billing?success=true' cancel_url='https://www.productgeniepro.com/pricing?cancelled=true'
2025-09-28T14:16:05.076829405Z Variant ID: 1013286
2025-09-28T14:16:05.076835756Z Success URL: https://www.productgeniepro.com/billing?success=true
2025-09-28T14:16:05.076841336Z Cancel URL: https://www.productgeniepro.com/pricing?cancelled=true
2025-09-28T14:16:05.076847696Z ðŸŽ¯ STEP 2: GETTING CLIENT INFO
2025-09-28T14:16:05.076854056Z Client info: {'ip_address': '41.238.10.39', 'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', 'correlation_id': 'f9230ce8-c447-49ca-bbf8-8c11255f082f'}
2025-09-28T14:16:05.076863476Z ðŸŽ¯ STEP 3: EXTRACTING AUTH DATA
2025-09-28T14:16:05.076867946Z User ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T14:16:05.076873876Z User email: ziad321hussein@gmail.com
2025-09-28T14:16:05.076879226Z ðŸŽ¯ STEP 4: VALIDATING USER
2025-09-28T14:16:05.076884737Z âœ… STEP 4 SUCCESS: User validated
2025-09-28T14:16:05.076890417Z ðŸŽ¯ STEP 5: VALIDATING VARIANT ID
2025-09-28T14:16:05.076895537Z âœ… STEP 5 SUCCESS: Variant ID validated
2025-09-28T14:16:05.076900657Z ðŸŽ¯ STEP 6: CALLING LEMON_SQUEEZY SERVICE
2025-09-28T14:16:05.076906017Z ðŸŽ¯ LEMON SQUEEZY PAYLOAD DEBUG ðŸŽ¯
2025-09-28T14:16:05.076911647Z === VARIABLES ===
2025-09-28T14:16:05.076931898Z Variant ID: 1013286
2025-09-28T14:16:05.076935748Z Store ID: 224253
2025-09-28T14:16:05.076938918Z User ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T14:16:05.076942318Z User Email: ziad321hussein@gmail.com
2025-09-28T14:16:05.076946308Z Success URL: https://www.productgeniepro.com/billing?success=true
2025-09-28T14:16:05.076948458Z Cancel URL: https://www.productgeniepro.com/pricing?cancelled=true
2025-09-28T14:16:05.076950568Z Test Mode: True
2025-09-28T14:16:05.076952688Z === PAYLOAD BEING SENT ===
2025-09-28T14:16:05.076954768Z {
2025-09-28T14:16:05.076956968Z   "data": {
2025-09-28T14:16:05.076959138Z     "type": "checkouts",
2025-09-28T14:16:05.076961198Z     "attributes": {
2025-09-28T14:16:05.076963278Z       "checkout_options": {
2025-09-28T14:16:05.076965328Z         "embed": false,
2025-09-28T14:16:05.076967348Z         "media": false
2025-09-28T14:16:05.076969639Z       },
2025-09-28T14:16:05.076971819Z       "checkout_data": {
2025-09-28T14:16:05.076973979Z         "email": "ziad321hussein@gmail.com",
2025-09-28T14:16:05.076978259Z         "custom": {
2025-09-28T14:16:05.076981029Z           "user_id": "bpR6MB3823T20EK7BEa3cs2y22u2"
2025-09-28T14:16:05.076983199Z         }
2025-09-28T14:16:05.076985269Z       },
2025-09-28T14:16:05.076987319Z       "product_options": {
2025-09-28T14:16:05.076989419Z         "redirect_url": "https://www.productgeniepro.com/billing?success=true"
2025-09-28T14:16:05.076991549Z       }
2025-09-28T14:16:05.076994029Z     },
2025-09-28T14:16:05.076996179Z     "relationships": {
2025-09-28T14:16:05.076998249Z       "store": {
2025-09-28T14:16:05.077000289Z         "data": {
2025-09-28T14:16:05.077003009Z           "type": "stores",
2025-09-28T14:16:05.077008719Z           "id": "224253"
2025-09-28T14:16:05.077012169Z         }
2025-09-28T14:16:05.077015269Z       },
2025-09-28T14:16:05.07701882Z       "variant": {
2025-09-28T14:16:05.07702218Z         "data": {
2025-09-28T14:16:05.07702569Z           "type": "variants",
2025-09-28T14:16:05.07704097Z           "id": "1013286"
2025-09-28T14:16:05.07704314Z         }
2025-09-28T14:16:05.07704519Z       }
2025-09-28T14:16:05.07704724Z     }
2025-09-28T14:16:05.07704932Z   }
2025-09-28T14:16:05.07705151Z }
2025-09-28T14:16:05.07705359Z === HEADERS ===
2025-09-28T14:16:05.0770557Z {
2025-09-28T14:16:05.07705881Z   "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI5NGQ1OWNlZi1kYmI4LTRlYTUtYjE3OC1kMjU0MGZjZDY5MTkiLCJqdGkiOiJkOGY2NTljZjdhMzA3ZGNjM2RjNTk4ZjNiMzU4YTk3YTczYzdhNGJkNDg2ZDlkM2JhYTE4OGQ4Y2MxMGU1Zjc5YWQzODJkZTgyYjgxNjRiNiIsImlhdCI6MTc1ODgyNzU5MC41NzYwMjcsIm5iZiI6MTc1ODgyNzU5MC41NzYwMjksImV4cCI6MjA3NDM2MDM5MC41NjA2NzcsInN1YiI6IjU1NzE5NjQiLCJzY29wZXMiOltdfQ.v6DQ8CrPGAovPSiYrv6Y3GkQ3DWHPcC0aAiZ9mP5BsXCwXoz5Kf1OY-fLAHC4ikcmx2RYZuLbSrF_Xxa4mvw2exFnJMsODiiuzItzhdVGUwR89IzbFAD6hcto-w0ERT3gjP781BJ-lxa7pzC4tCADeRhAtMPM7MZ7h7g-0JsRjXyNDrM0ArKoN84kiGHojmPCBomBuXTQ-mC_VQEWn8PKxTbZEem7FoyP4ydK46xYQu-naukuPTOZHRQ44Mdz_16JQ7Cda2pbfJo2osSPGaLTYUKvH0-aF2jlZToxGCPPr8LbPsHo1-96W2D6CBkCF0kFd6BQd0PKw64X-2ywolNwyna51cLKvkZuOHrh2Z8XVG0GONxeo6b1mFzgs8PzSkaPJ5Er_vhcRQVhAolOVmBHcZ61FUUJ208hR1FUVzMHlrTWtcTAi6HUjthHZB2ZL0xrIkDcWQPxG38i8ArAslXFLytqDTU3tePixq0WDHHBnBq8XSbleFoLH8rdc0j4v5KEPoJyXUS7MrHkiJ602WwLFPuczEdkRPvnSNeRKhsSlPkO8SiQFdHZ6VLCGQoEWDvm7SL2U6lmOJ2T1imOAGiTveGoliycICl_HQo29Fk0VFMFVa_jei7HCgdsLArClUHceqfx5UTOsrWxcd8zr75ALBqDzIWT9tpG5ifdTappes",
2025-09-28T14:16:05.077063721Z   "Accept": "application/vnd.api+json",
2025-09-28T14:16:05.07706583Z   "Content-Type": "application/vnd.api+json",
2025-09-28T14:16:05.077067951Z   "Version": "2021-07-07"
2025-09-28T14:16:05.077075091Z }
2025-09-28T14:16:05.077077341Z === API ENDPOINT ===
2025-09-28T14:16:05.077079501Z POST https://api.lemonsqueezy.com/v1/checkouts
2025-09-28T14:16:05.077081571Z === RESPONSE ===
2025-09-28T14:16:05.077083601Z Status: Unknown
2025-09-28T14:16:05.077085651Z Response: {
2025-09-28T14:16:05.077087741Z   "jsonapi": {
2025-09-28T14:16:05.077089871Z     "version": "1.0"
2025-09-28T14:16:05.077091941Z   },
2025-09-28T14:16:05.077094641Z   "links": {
2025-09-28T14:16:05.077099191Z     "self": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f"
2025-09-28T14:16:05.077102931Z   },
2025-09-28T14:16:05.077106262Z   "data": {
2025-09-28T14:16:05.077109811Z     "type": "checkouts",
2025-09-28T14:16:05.077113082Z     "id": "aa12cfec-b202-435d-9b8b-87524543032f",
2025-09-28T14:16:05.077116552Z     "attributes": {
2025-09-28T14:16:05.077119372Z       "store_id": 224253,
2025-09-28T14:16:05.077122702Z       "variant_id": 1013286,
2025-09-28T14:16:05.077126282Z       "custom_price": null,
2025-09-28T14:16:05.077130032Z       "product_options": {
2025-09-28T14:16:05.077132522Z         "name": "",
2025-09-28T14:16:05.077134582Z         "description": "",
2025-09-28T14:16:05.077136622Z         "media": [],
2025-09-28T14:16:05.077138762Z         "redirect_url": "https://www.productgeniepro.com/billing?success=true",
2025-09-28T14:16:05.077140852Z         "receipt_button_text": "",
2025-09-28T14:16:05.077142942Z         "receipt_link_url": "",
2025-09-28T14:16:05.077145082Z         "receipt_thank_you_note": "",
2025-09-28T14:16:05.077147132Z         "enabled_variants": [],
2025-09-28T14:16:05.077149272Z         "confirmation_title": "",
2025-09-28T14:16:05.077151372Z         "confirmation_message": "",
2025-09-28T14:16:05.077153432Z         "confirmation_button_text": ""
2025-09-28T14:16:05.077155523Z       },
2025-09-28T14:16:05.077157612Z       "checkout_options": {
2025-09-28T14:16:05.077159723Z         "embed": false,
2025-09-28T14:16:05.077176173Z         "media": false,
2025-09-28T14:16:05.077178493Z         "logo": true,
2025-09-28T14:16:05.077180603Z         "desc": true,
2025-09-28T14:16:05.077182643Z         "discount": true,
2025-09-28T14:16:05.077184683Z         "skip_trial": false,
2025-09-28T14:16:05.077186693Z         "quantity": 1,
2025-09-28T14:16:05.077188813Z         "subscription_preview": true,
2025-09-28T14:16:05.077190943Z         "locale": "en"
2025-09-28T14:16:05.077193033Z       },
2025-09-28T14:16:05.077195073Z       "checkout_data": {
2025-09-28T14:16:05.077197173Z         "email": "ziad321hussein@gmail.com",
2025-09-28T14:16:05.077199244Z         "name": "",
2025-09-28T14:16:05.077201264Z         "billing_address": [],
2025-09-28T14:16:05.077203304Z         "tax_number": "",
2025-09-28T14:16:05.077205354Z         "discount_code": "",
2025-09-28T14:16:05.077207444Z         "custom": {
2025-09-28T14:16:05.077209634Z           "user_id": "bpR6MB3823T20EK7BEa3cs2y22u2"
2025-09-28T14:16:05.077211784Z         },
2025-09-28T14:16:05.077213924Z         "variant_quantities": []
2025-09-28T14:16:05.077215994Z       },
2025-09-28T14:16:05.077218054Z       "preview": false,
2025-09-28T14:16:05.077220114Z       "expires_at": null,
2025-09-28T14:16:05.077222224Z       "created_at": "2025-09-28T14:16:05.000000Z",
2025-09-28T14:16:05.077224334Z       "updated_at": "2025-09-28T14:16:05.000000Z",
2025-09-28T14:16:05.077226374Z       "test_mode": true,
2025-09-28T14:16:05.077229414Z       "url": "https://product-genie.lemonsqueezy.com/checkout/custom/aa12cfec-b202-435d-9b8b-87524543032f?signature=82961e0a66c12494420ac593f9d57fa089ec8475e77f748a461118129101f8af"
2025-09-28T14:16:05.077236114Z     },
2025-09-28T14:16:05.077238254Z     "relationships": {
2025-09-28T14:16:05.077240305Z       "store": {
2025-09-28T14:16:05.077242365Z         "links": {
2025-09-28T14:16:05.077245305Z           "related": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f/store",
2025-09-28T14:16:05.077247974Z           "self": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f/relationships/store"
2025-09-28T14:16:05.077250045Z         }
2025-09-28T14:16:05.077252075Z       },
2025-09-28T14:16:05.077254125Z       "variant": {
2025-09-28T14:16:05.077256135Z         "links": {
2025-09-28T14:16:05.077258215Z           "related": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f/variant",
2025-09-28T14:16:05.077260335Z           "self": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f/relationships/variant"
2025-09-28T14:16:05.077262475Z         }
2025-09-28T14:16:05.077264505Z       }
2025-09-28T14:16:05.077266665Z     },
2025-09-28T14:16:05.077268765Z     "links": {
2025-09-28T14:16:05.077270885Z       "self": "https://api.lemonsqueezy.com/v1/checkouts/aa12cfec-b202-435d-9b8b-87524543032f"
2025-09-28T14:16:05.077273015Z     }
2025-09-28T14:16:05.077275085Z   }
2025-09-28T14:16:05.077277135Z }
2025-09-28T14:16:05.077279255Z âœ… STEP 6 SUCCESS: Lemon Squeezy service call successful
2025-09-28T14:16:05.077281925Z Result: {'success': True, 'checkout_url': 'https://product-genie.lemonsqueezy.com/checkout/custom/aa12cfec-b202-435d-9b8b-87524543032f?signature=82961e0a66c12494420ac593f9d57fa089ec8475e77f748a461118129101f8af', 'checkout_id': 'aa12cfec-b202-435d-9b8b-87524543032f'}
2025-09-28T14:16:05.077284165Z INFO:     41.238.10.39:0 - "POST /api/payment/checkout HTTP/1.1" 200 OK
2025-09-28T14:16:05.100796579Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:05.103775295Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:05.198914654Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:07.385033771Z INFO:     connection closed
2025-09-28T14:16:19.878713059Z ==> Detected service running on port 10000
2025-09-28T14:16:20.112275907Z ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
2025-09-28T14:16:40.453688972Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T14:16:40.453410+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T14:16:40.687654521Z ðŸŽ¯ WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T14:16:40.687677431Z ðŸŽ¯ WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '1997', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9863dc248a35a3ae-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': '593da685-3025-432d', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_payment_success', 'x-forwarded-for': '18.116.135.47, 104.23.243.128, 10.226.170.195', 'x-forwarded-proto': 'https', 'x-request-start': '1759069000450971', 'x-signature': '6b2aad5118ffcdf949060a987cba9c3da46f7288496beb029b053363ebb68c2e'}
2025-09-28T14:16:40.687681291Z ðŸŽ¯ BillingService: Processing webhook event_id=6b2aad5118ffcdf949060a987cba9c3da46f7288496beb029b053363ebb68c2e
2025-09-28T14:16:40.687684911Z ðŸŽ¯ BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_payment_success', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': '2953d23d-af66-40bc-8a27-b48fe9714f6e'}, 'data': {'type': 'subscription-invoices', 'id': '4586563', 'attributes': {'store_id': 224253, 'subscription_id': 1521013, 'customer_id': 6829303, 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'billing_reason': 'initial', 'card_brand': 'visa', 'card_last_four': '4242', 'currency': 'USD', 'currency_rate': '1.00000000', 'status': 'paid', 'status_formatted': 'Paid', 'refunded': False, 'refunded_at': None, 'subtotal': 499, 'discount_total': 0, 'tax': 0, 'tax_inclusive': False, 'total': 499, 'refunded_amount': 0, 'subtotal_usd': 499, 'discount_total_usd': 0, 'tax_usd': 0, 'total_usd': 499, 'refunded_amount_usd': 0, 'subtotal_formatted': '$4.99', 'discount_total_formatted': '$0.00', 'tax_formatted': '$0.00', 'total_formatted': '$4.99', 'refunded_amount_formatted': '$0.00', 'urls': {'invoice_url': 'https://app.lemonsqueezy.com/my-orders/448e94e5-7b5d-4360-8b2d-9f045c36fc68/subscription-invoice/4586563?expires=1759090600&signature=9a56d0435a6b9306682a3cd1cb135edf701dff69341f7226f41a9fd0671217fd'}, 'created_at': '2025-09-28T14:16:35.000000Z', 'updated_at': '2025-09-28T14:16:40.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/store', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/relationships/store'}}, 'subscription': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/subscription', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/relationships/subscription'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563/relationships/customer'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscription-invoices/4586563'}}}
2025-09-28T14:16:40.687702591Z ðŸŽ¯ BillingService: Event 6b2aad5118ffcdf949060a987cba9c3da46f7288496beb029b053363ebb68c2e is new, processing...
2025-09-28T14:16:40.687706092Z ðŸŽ¯ BillingService: Event type: subscription_payment_success
2025-09-28T14:16:40.687721452Z ðŸŽ¯ BillingService: Attributes: {'store_id': 224253, 'subscription_id': 1521013, 'customer_id': 6829303, 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'billing_reason': 'initial', 'card_brand': 'visa', 'card_last_four': '4242', 'currency': 'USD', 'currency_rate': '1.00000000', 'status': 'paid', 'status_formatted': 'Paid', 'refunded': False, 'refunded_at': None, 'subtotal': 499, 'discount_total': 0, 'tax': 0, 'tax_inclusive': False, 'total': 499, 'refunded_amount': 0, 'subtotal_usd': 499, 'discount_total_usd': 0, 'tax_usd': 0, 'total_usd': 499, 'refunded_amount_usd': 0, 'subtotal_formatted': '$4.99', 'discount_total_formatted': '$0.00', 'tax_formatted': '$0.00', 'total_formatted': '$4.99', 'refunded_amount_formatted': '$0.00', 'urls': {'invoice_url': 'https://app.lemonsqueezy.com/my-orders/448e94e5-7b5d-4360-8b2d-9f045c36fc68/subscription-invoice/4586563?expires=1759090600&signature=9a56d0435a6b9306682a3cd1cb135edf701dff69341f7226f41a9fd0671217fd'}, 'created_at': '2025-09-28T14:16:35.000000Z', 'updated_at': '2025-09-28T14:16:40.000000Z', 'test_mode': True}
2025-09-28T14:16:40.687725222Z ðŸ”„ Found existing user with email ziad321hussein@gmail.com, using ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T14:16:40.687728082Z ðŸŽ¯ BillingService: Checking event type 'subscription_payment_success' against subscription events
2025-09-28T14:16:40.687731022Z ðŸŽ¯ BillingService: is_subscription_event=True, has_subscription_data=False
2025-09-28T14:16:40.687733692Z âš ï¸  No variant_id found in webhook data
2025-09-28T14:16:40.687736302Z âš ï¸  Defaulting to free plan
2025-09-28T14:16:40.687739002Z ðŸ”„ Updating existing subscription for user ziad321hussein: pro -> free
2025-09-28T14:16:40.687748783Z âœ… Updated subscription for user ziad321hussein: plan=free, status=SubscriptionStatus.active
2025-09-28T14:16:40.687751853Z âœ… Updated subscription for user ziad321hussein: plan=free, status=SubscriptionStatus.active
2025-09-28T14:16:40.687754503Z âœ… Committed subscription update to database
2025-09-28T14:16:40.687757273Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK
2025-09-28T14:16:41.977276274Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T14:16:41.977024+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T14:16:41.997601507Z ðŸŽ¯ WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T14:16:41.997623107Z ðŸŽ¯ WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '3394', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9863dc2dff5c3a24-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': 'cd689f93-f4dd-428e', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_created', 'x-forwarded-for': '18.116.135.47, 104.23.243.80, 10.226.170.195', 'x-forwarded-proto': 'https', 'x-request-start': '1759069001974814', 'x-signature': '3056c0b7655b33c2a27bc9a99bd037bb168ef7107527ba343f01fbd1f5b796a5'}
2025-09-28T14:16:41.997629597Z ðŸŽ¯ BillingService: Processing webhook event_id=3056c0b7655b33c2a27bc9a99bd037bb168ef7107527ba343f01fbd1f5b796a5
2025-09-28T14:16:41.997644778Z ðŸŽ¯ BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_created', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': '93cf6943-c444-453d-a86a-902d3fc0368c'}, 'data': {'type': 'subscriptions', 'id': '1521013', 'attributes': {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492033, 'order_item_id': 6435870, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4508348, 'subscription_id': 1521013, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T14:16:41.000000Z', 'updated_at': '2025-09-28T14:16:41.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521013/payment-details?expires=1759090601&signature=514208d38e75d8bd1c5b6883dd2c06c457db0dea005c2bd0a02dd0152c119187', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759090601&test_mode=1&user=5534177&signature=112af4d8f148dfd7f6885ee6a5a342118ed1b0a46349aca6b62321301e2f4cdd', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521013/update?expires=1759090601&user=5534177&signature=dc84a0e8d7e04f0939a6160d5458e3af9e176d36bb5f1e8e5efcfc1b4c377a99'}, 'renews_at': '2025-10-28T14:16:32.000000Z', 'ends_at': None, 'created_at': '2025-09-28T14:16:34.000000Z', 'updated_at': '2025-09-28T14:16:39.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/store', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/store'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/customer'}}, 'order': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/order', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/order'}}, 'order-item': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/order-item', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/order-item'}}, 'product': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/product', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/product'}}, 'variant': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/variant', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/variant'}}, 'subscription-items': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/subscription-items', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/subscription-items'}}, 'subscription-invoices': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/subscription-invoices', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/subscription-invoices'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013'}}}
2025-09-28T14:16:41.997663638Z ðŸŽ¯ BillingService: Event 3056c0b7655b33c2a27bc9a99bd037bb168ef7107527ba343f01fbd1f5b796a5 is new, processing...
2025-09-28T14:16:41.997667488Z ðŸŽ¯ BillingService: Event type: subscription_created
2025-09-28T14:16:41.997685319Z ðŸŽ¯ BillingService: Attributes: {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492033, 'order_item_id': 6435870, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4508348, 'subscription_id': 1521013, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T14:16:41.000000Z', 'updated_at': '2025-09-28T14:16:41.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521013/payment-details?expires=1759090601&signature=514208d38e75d8bd1c5b6883dd2c06c457db0dea005c2bd0a02dd0152c119187', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759090601&test_mode=1&user=5534177&signature=112af4d8f148dfd7f6885ee6a5a342118ed1b0a46349aca6b62321301e2f4cdd', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521013/update?expires=1759090601&user=5534177&signature=dc84a0e8d7e04f0939a6160d5458e3af9e176d36bb5f1e8e5efcfc1b4c377a99'}, 'renews_at': '2025-10-28T14:16:32.000000Z', 'ends_at': None, 'created_at': '2025-09-28T14:16:34.000000Z', 'updated_at': '2025-09-28T14:16:39.000000Z', 'test_mode': True}
2025-09-28T14:16:41.997689559Z ðŸ”„ Found existing user with email ziad321hussein@gmail.com, using ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T14:16:41.997692879Z ðŸŽ¯ BillingService: Checking event type 'subscription_created' against subscription events
2025-09-28T14:16:41.997696509Z ðŸŽ¯ BillingService: is_subscription_event=True, has_subscription_data=True
2025-09-28T14:16:41.997699529Z ðŸ”§ Mapping variant_id: 1013286 (type: <class 'int'>)
2025-09-28T14:16:41.997702599Z ðŸ”§ Available mappings: {'1013286': 'pro', '1013276': 'enterprise', '1013282': 'pro-yearly'}
2025-09-28T14:16:41.997706039Z ðŸ”§ Mapped to plan: pro
2025-09-28T14:16:41.997709589Z ðŸ”§ Mapped variant_id 1013286 to plan: pro
2025-09-28T14:16:41.997712489Z ðŸ”„ Updating existing subscription for user ziad321hussein: free -> pro
2025-09-28T14:16:41.997715549Z âœ… Updated subscription for user ziad321hussein: plan=pro, status=SubscriptionStatus.active
2025-09-28T14:16:41.99772389Z âœ… Updated subscription for user ziad321hussein: plan=pro, status=SubscriptionStatus.active
2025-09-28T14:16:41.997727059Z âœ… Committed subscription update to database
2025-09-28T14:16:41.99773048Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK
2025-09-28T14:16:43.125108161Z INFO:     41.238.10.39:0 - "WebSocket /ws/payments" [accepted]
2025-09-28T14:16:43.125284395Z INFO:     connection open
2025-09-28T14:16:43.234851075Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:43.252207681Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:43.253618853Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:43.461792877Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:43.60562151Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:43.607307328Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:43.709751609Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:43.77406397Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:43.775898991Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:43.937876628Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:43.941160781Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:44.060293133Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:44.237264554Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:44.426252622Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:47.122725341Z INFO:     41.238.10.39:0 - "GET /api/payment/plans HTTP/1.1" 200 OK
2025-09-28T14:16:47.276927515Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:47.278495219Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:47.378598578Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:47.619373349Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:47.62118715Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:47.73885829Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:16:47.826061071Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:16:47.827762059Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:16:47.95713796Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:17:11.582872583Z WARNING:security:{"event_type": "webhook_received", "user_id": null, "timestamp": "2025-09-28T14:17:11.582643+00:00", "ip_address": null, "user_agent": null, "event_data": {"signature_provided": true, "signature_valid": true}, "security_level": "high", "success": true, "error_message": null, "session_id": null, "correlation_id": null}
2025-09-28T14:17:11.606952449Z ðŸŽ¯ WEBHOOK RECEIVED: POST https://ai-product-descriptions.onrender.com/api/payment/webhook
2025-09-28T14:17:11.606985569Z ðŸŽ¯ WEBHOOK HEADERS: {'host': 'ai-product-descriptions.onrender.com', 'user-agent': 'LemonSqueezy-Hookshot', 'content-length': '3394', 'accept-encoding': 'gzip, br', 'cdn-loop': 'cloudflare; loops=1', 'cf-connecting-ip': '18.116.135.47', 'cf-ipcountry': 'US', 'cf-ray': '9863dce71f7f1709-CMH', 'cf-visitor': '{"scheme":"https"}', 'content-type': 'application/json', 'render-proxy-ttl': '4', 'rndr-id': '605698c1-e2d5-4c52', 'true-client-ip': '18.116.135.47', 'x-event-name': 'subscription_updated', 'x-forwarded-for': '18.116.135.47, 104.23.197.55, 10.226.170.195', 'x-forwarded-proto': 'https', 'x-request-start': '1759069031579766', 'x-signature': '43e0b7280d91f7a64a13bd2c46b98a4ac2b87265a1d4696fede14bb6cb6e591b'}
2025-09-28T14:17:11.606989349Z ðŸŽ¯ BillingService: Processing webhook event_id=43e0b7280d91f7a64a13bd2c46b98a4ac2b87265a1d4696fede14bb6cb6e591b
2025-09-28T14:17:11.60699666Z ðŸŽ¯ BillingService: Event data: {'meta': {'test_mode': True, 'event_name': 'subscription_updated', 'custom_data': {'user_id': 'bpR6MB3823T20EK7BEa3cs2y22u2'}, 'webhook_id': 'fdb7df01-309e-4fe1-b5c0-cb96a3131026'}, 'data': {'type': 'subscriptions', 'id': '1521013', 'attributes': {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492033, 'order_item_id': 6435870, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4508348, 'subscription_id': 1521013, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T14:16:41.000000Z', 'updated_at': '2025-09-28T14:17:11.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521013/payment-details?expires=1759090631&signature=256a7b28b2bc4b91f092b4ce32488c05fc10a90053cca16a9afecd53a45f7e53', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759090631&test_mode=1&user=5534177&signature=7f3135f73f6f04a2e9f0b934a7badf2a97b6a314e7804136dc8f7944188a8c0c', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521013/update?expires=1759090631&user=5534177&signature=3577a4f77e351fd1a3d22adb3666e50cbde0a98feeca9698bc4c358aa041e622'}, 'renews_at': '2025-10-28T14:16:32.000000Z', 'ends_at': None, 'created_at': '2025-09-28T14:16:34.000000Z', 'updated_at': '2025-09-28T14:16:39.000000Z', 'test_mode': True}, 'relationships': {'store': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/store', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/store'}}, 'customer': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/customer', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/customer'}}, 'order': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/order', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/order'}}, 'order-item': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/order-item', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/order-item'}}, 'product': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/product', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/product'}}, 'variant': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/variant', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/variant'}}, 'subscription-items': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/subscription-items', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/subscription-items'}}, 'subscription-invoices': {'links': {'related': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/subscription-invoices', 'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013/relationships/subscription-invoices'}}}, 'links': {'self': 'https://api.lemonsqueezy.com/v1/subscriptions/1521013'}}}
2025-09-28T14:17:11.60700366Z ðŸŽ¯ BillingService: Event 43e0b7280d91f7a64a13bd2c46b98a4ac2b87265a1d4696fede14bb6cb6e591b is new, processing...
2025-09-28T14:17:11.60700684Z ðŸŽ¯ BillingService: Event type: subscription_updated
2025-09-28T14:17:11.60702158Z ðŸŽ¯ BillingService: Attributes: {'store_id': 224253, 'customer_id': 6829303, 'order_id': 6492033, 'order_item_id': 6435870, 'product_id': 645534, 'variant_id': 1013286, 'product_name': 'Get Extra Product Descriptions', 'variant_name': 'Pro Plan', 'user_name': 'Zeyad Sherif', 'user_email': 'ziad321hussein@gmail.com', 'status': 'active', 'status_formatted': 'Active', 'card_brand': 'visa', 'card_last_four': '4242', 'payment_processor': 'stripe', 'pause': None, 'cancelled': False, 'trial_ends_at': None, 'billing_anchor': 28, 'first_subscription_item': {'id': 4508348, 'subscription_id': 1521013, 'price_id': 1608947, 'quantity': 1, 'is_usage_based': False, 'created_at': '2025-09-28T14:16:41.000000Z', 'updated_at': '2025-09-28T14:17:11.000000Z'}, 'urls': {'update_payment_method': 'https://product-genie.lemonsqueezy.com/subscription/1521013/payment-details?expires=1759090631&signature=256a7b28b2bc4b91f092b4ce32488c05fc10a90053cca16a9afecd53a45f7e53', 'customer_portal': 'https://product-genie.lemonsqueezy.com/billing?expires=1759090631&test_mode=1&user=5534177&signature=7f3135f73f6f04a2e9f0b934a7badf2a97b6a314e7804136dc8f7944188a8c0c', 'customer_portal_update_subscription': 'https://product-genie.lemonsqueezy.com/billing/1521013/update?expires=1759090631&user=5534177&signature=3577a4f77e351fd1a3d22adb3666e50cbde0a98feeca9698bc4c358aa041e622'}, 'renews_at': '2025-10-28T14:16:32.000000Z', 'ends_at': None, 'created_at': '2025-09-28T14:16:34.000000Z', 'updated_at': '2025-09-28T14:16:39.000000Z', 'test_mode': True}
2025-09-28T14:17:11.60702668Z ðŸ”„ Found existing user with email ziad321hussein@gmail.com, using ID: bpR6MB3823T20EK7BEa3cs2y22u2
2025-09-28T14:17:11.607030401Z ðŸŽ¯ BillingService: Checking event type 'subscription_updated' against subscription events
2025-09-28T14:17:11.60703451Z ðŸŽ¯ BillingService: is_subscription_event=True, has_subscription_data=True
2025-09-28T14:17:11.60703799Z ðŸ”§ Mapping variant_id: 1013286 (type: <class 'int'>)
2025-09-28T14:17:11.607041661Z ðŸ”§ Available mappings: {'1013286': 'pro', '1013276': 'enterprise', '1013282': 'pro-yearly'}
2025-09-28T14:17:11.607045501Z ðŸ”§ Mapped to plan: pro
2025-09-28T14:17:11.607049431Z ðŸ”§ Mapped variant_id 1013286 to plan: pro
2025-09-28T14:17:11.607052551Z ðŸ”„ Updating existing subscription for user ziad321hussein: pro -> pro
2025-09-28T14:17:11.607055741Z âœ… Updated subscription for user ziad321hussein: plan=pro, status=SubscriptionStatus.active
2025-09-28T14:17:11.607059391Z âœ… Updated subscription for user ziad321hussein: plan=pro, status=SubscriptionStatus.active
2025-09-28T14:17:11.607062431Z âœ… Committed subscription update to database
2025-09-28T14:17:11.607065931Z INFO:     18.116.135.47:0 - "POST /api/payment/webhook HTTP/1.1" 200 OK
2025-09-28T14:17:37.599441937Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:17:37.603542599Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:17:37.683406077Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK
2025-09-28T14:17:37.916703591Z WARNING:src.payments.endpoints:User bpR6MB3823T20EK7BEa3cs2y22u2 has no subscription record, returning free tier
2025-09-28T14:17:37.919211677Z INFO:     41.238.10.39:0 - "GET /api/payment/user/subscription HTTP/1.1" 200 OK
2025-09-28T14:17:38.054152492Z INFO:     41.238.10.39:0 - "GET /api/payment/user/credits HTTP/1.1" 200 OK